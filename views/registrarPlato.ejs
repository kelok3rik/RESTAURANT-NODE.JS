<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Font Awesome y Boostrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
        integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"> -->
    <!-- Datatables -->
    <!-- <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.2/css/buttons.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.5.0/css/select.dataTables.min.css"> -->




    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css">

    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.dataTables.min.css"> -->




    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@5.1.0/dist/css/bootstrap.min.css">

    <!-- Bootstrap JS and dependencies -->
    <script src="https://unpkg.com/@popperjs/core@2.10.3/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>


    <!-- CSS de DataTables y del plugin "Responsive" -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap5.min.css">

    <title>RES</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Mi Sitio</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Inicio</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Mantenimientos
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="/mantenimientoCategoria">Categoría</a></li>
                            <li><a class="dropdown-item" href="/mantenimientoEmpleado">Empleado</a></li>
                            <li><a class="dropdown-item" href="/mantenimientoPlatos">Platos</a></li>
                            <li><a class="dropdown-item" href="/mantenimientoIngredientes">Ingredientes</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/ordenar">Ordenar</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#">Nombre del Usuario</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Cerrar Sesión</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid p-5">
        <div class="card-header">
            <div class="card-header">Nuevo Registros</div>
            <div class="card-body">
                <form id="form" action="/savePlatos" method="POST">
                    <div class="mb-3">
                        <label for="user" class="form-label">NOMBRE</label>
                        <input type="text" class="form-control" id="NOMBRE" name="NOMBRE" tabindex="1">
                    </div>
                    <div class="mb-3">
                        <label for="pass" class="form-label">PRECIO</label>
                        <input type="text" class="form-control" id="PRECIO" name="PRECIO" tabindex="2">
                    </div>
                    <div class="mb-3">
                        <label for="pass" class="form-label">DESCRIPCION</label>
                        <input type="text" class="form-control" id="DESCRIPCION" name="DESCRIPCION" tabindex="2">
                    </div>
                    <div class="mb-3">
                        <label for="pass" class="form-label">CATEGORIA</label>

                        <select class="form-select" id="CATEGORIA" name="CATEGORIA">
                            <% for (let i=0; i < results.length; i++) { %>
                                <option value="<%= results[i].ID %>">
                                    <%= results[i].Nombre %>
                                </option>
                                <% } %>
                        </select>
                    </div>


                    <label for="user" class="form-label">INGREDIENTES</label>
                    <div class="input-group mb-3">

                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <select class="form-select" id="select1">
                                    <% for (let i=0; i < ingredientes.length; i++) { %>
                                        <option value="<%= ingredientes[i].ID %>">
                                            <%= ingredientes[i].Nombre %>
                                        </option>
                                        <% } %>
                                </select>
                            </div>
                            <div class="col-md-3 mb-2">
                                <input type="number" class="form-control" id="input1" min='1'
                                    placeholder="Ingrese la cantidad">
                            </div>
                            <div class="col-md-3 mb-2">
                                <select class="form-select" id="select2">
                                    <option value="Gramos">Gramos (g)</option>
                                    <option value="Kilogramos">Kilogramos (kg)</option>
                                    <option value="Onzas">Onzas (oz)</option>
                                    <option value="Libras">Libras (lb)</option>
                                    <option value="Mililitros">Mililitros (ml)</option>
                                    <option value="Litros">Litros (l)</option>
                                    <option value="Cucharadas">Cucharadas (tbsp)</option>
                                    <option value="Tazas">Tazas (cup)</option>
                                    <option value="Pintas">Pintas (pt)</option>
                                    <option value="Cuartos">Cuartos (qt)</option>
                                    <option value="Galones">Galones (gal)</option>
                                    <option value="Unidad">Unidad</option>
                                </select>
                            </div>

                            <div class="col-md-3 mb-2">
                                <input type="number" class="form-control" id="input3" min='1' max="5"
                                    placeholder="Ingrese la prioridad">
                            </div>

                            <div class="col-md-3 mb-2">
                                <button class="btn btn-primary" type="button" id="button1">Agregar</button>
                            </div>
                        </div>
                    </div>

                    <table id='table' class="table table-primary table-bordered table-striped table-hover">
                        <thead class="table-success">
                            <tr class="bg-primary text-white">
                                <th scope="col">NOMBRE</th>
                                <th scope="col">CANTIDAD</th>
                                <th scope="col">MEDIDA</th>
                                <th scope="col">PRIORIDAD</th>
                                <th scope="col">ACCIONES</th>

                            </tr>
                        </thead>
                        <tbody id="table-body">

                        </tbody>

                    </table>



                    <button class="btn btn-primary" type="button" onclick="registrarPlato()">Guardar</button>
                    <a href="/mantenimientoPlatos" class="btn btn-secondary">Cancelar</a>
                </form>
            </div>
        </div>
    </div>
</body>

</html>

<!-- JavaScript de jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- JavaScript de DataTables y del plugin "Responsive" -->

<script type="text/javascript" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap5.min.js"></script>
<script type="text/javascript"
    src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
<script type="text/javascript"
    src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap5.min.js"></script>


<script src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>



<script>

    const tableBody = document.getElementById("table-body");
    const select1 = document.getElementById("select1");
    const input1 = document.getElementById("input1");
    const select2 = document.getElementById("select2");
    const input3 = document.getElementById("input3");
    const button1 = document.getElementById("button1");

    button1.addEventListener("click", agregarFila);

    function agregarFila() {
        const fila = document.createElement("tr");

        const nombre = document.createElement("td");
        nombre.innerHTML = select1.value;

        const cantidad = document.createElement("td");
        cantidad.innerHTML = input1.value;

        const medida = document.createElement("td");
        medida.innerHTML = select2.value;

        const prioridad = document.createElement("td");
        prioridad.innerHTML = input3.value;

        console.log(nombre.innerHTML);

        const acciones = document.createElement("td");

        const botonEliminar = document.createElement("button");

        botonEliminar.innerText = "Eliminar";
        botonEliminar.addEventListener("click", function () {
            fila.remove();
        });

        acciones.appendChild(botonEliminar);

        fila.appendChild(nombre);
        fila.appendChild(cantidad);
        fila.appendChild(medida);
        fila.appendChild(prioridad);
        fila.appendChild(acciones);

        tableBody.appendChild(fila);

        // Limpiar los campos después de agregar una fila
        input1.value = "";
        input3.value = "";
    }

    async function registrarPlato() {
        const nombrePlato = document.getElementById("NOMBRE").value;
        const descripcionPlato = document.getElementById("DESCRIPCION").value;
        const precioPlato = document.getElementById("PRECIO").value;
        const categoriaPlato = document.getElementById("CATEGORIA").value;


        // Obtener los ingredientes de la tabla y agregarlos a un arreglo
        const ingredientes = [];
        const filas = document.querySelectorAll("#table-body tr");

        // console.log(filas);

        filas.forEach((fila) => {
            const celdas = fila.querySelectorAll("td");

            const ingrediente = {
                nombre: celdas[0].innerHTML,
                cantidad: celdas[1].innerHTML,
                medida: celdas[2].innerHTML,
                prioridad: celdas[3].innerHTML,
            };
            ingredientes.push(ingrediente);
        });
        try {
            const response = await fetch("http://localhost:5000/savePlatos", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    nombrePlato: nombrePlato,
                    descripcionPlato: descripcionPlato,
                    precioPlato: precioPlato,
                    categoriaPlato: categoriaPlato,
                    ingredientes: ingredientes,
                }),
            });

            if (!response.ok) {
                throw new Error("Error al registrar el plato.");
            }
            alert("iNSERTADO CORRECTAMENTE");
            window.location.href = "/mantenimientoPlatos";


        } catch (error) {
            console.error(error);
            alert("Error al registrar el plato.");
        }





    }


</script>

<!-- <script>


    let button = document.getElementById('button1');
    let select1 = document.getElementById('select1');
    let input1 = document.getElementById('input1');
    let select2 = document.getElementById('select2');
    let input3 = document.getElementById('input3');
    let tableBody = document.getElementById('table-body');

    button.addEventListener('click', function () {

        let ingrediente = select1.value;
        let cantidad = input1.value;
        let unidad = select2.value;
        let prioridad = input3.value;

        // Crear una nueva fila en la tabla
        let newRow = tableBody.insertRow();

        // Agregar celdas a la fila
        let cell1 = newRow.insertCell(0);
        let cell2 = newRow.insertCell(1);
        let cell3 = newRow.insertCell(2);
        let cell4 = newRow.insertCell(3);
        let cell5 = newRow.insertCell(4);

        // Agregar contenido a las celdas
        cell1.innerHTML = ingrediente;
        cell2.innerHTML = cantidad;
        cell3.innerHTML = unidad;
        cell4.innerHTML = prioridad;
        cell5.innerHTML = '<button class="btn btn-danger" type="button" onclick="eliminarFila(this)">Eliminar</button>'; // Agregado botón de eliminar


        // Limpiar los valores de los campos de entrada después de agregar la fila
        select1.selectedIndex = 0;
        input1.value = '';
        select2.selectedIndex = 0;
        input3.value = '';
    });

    // Agregar evento de clic al botón de eliminar para eliminar la fila correspondiente
    function eliminarFila(boton) {
        var row = boton.parentNode.parentNode;
        row.parentNode.removeChild(row);
    }

    ///PRUEBAAAAA////////////////

    // Obtener el botón de guardar
    var guardarBtn = document.getElementById("guardar-btn");

    // Agregar un evento de clic al botón de guardar
    guardarBtn.addEventListener("click", function () {
        // Obtener la tabla y sus filas
        var table = document.getElementById("table");
        var rows = table.children[1].children;

        // Crear un array vacío para almacenar los datos
        var data = [];

        // Iterar sobre las filas de la tabla y obtener los valores de cada celda
        for (var i = 1; i < rows.length; i++) {
            var row = rows[i];
            var cells = row.getElementsByTagName("td");
            var nombre = cells[0].innerHTML;
            var cantidad = cells[1].innerHTML;
            var medida = cells[2].innerHTML;
            var prioridad = cells[3].innerHTML;

            // Agregar los valores a un objeto JavaScript y agregar el objeto al array
            data.push({ nombre: nombre, cantidad: cantidad, medida: medida, prioridad: prioridad });
            console.log(data);
        }

        // Enviar los datos al servidor mediante una solicitud HTTP POST
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/guardar"); // Ruta en tu servidor para guardar los datos
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.onload = function () {
            if (xhr.status === 200) {
                console.log("Datos guardados correctamente");
            } else {
                console.error("Error al guardar los datos: " + xhr.statusText);
            }
        };
        xhr.send(JSON.stringify(data));
    });














    // const datos = [
    //     { plato_id: 5, ingrediente_id: 6, cantidad: 200, unidad: 'gr', prioridad: 1 },
    //     { plato_id: 5, ingrediente_id: 7, cantidad: 1, unidad: 'un', prioridad: 2 },
    //     { plato_id: 5, ingrediente_id: 8, cantidad: 250, unidad: 'ml', prioridad: 1 }
    // ];

    // let dato = document.getElementById('datos').value;
    // dato.value = JSON.stringify(datos);

    // console.log(dato);










    // $(document).ready(function () {
    //     // Inicializar DataTable
    //     $('#tabla').DataTable({
    //         "language": {
    //             "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"
    //         },
    //     });

    //     var table = $('#tabla').DataTable();

    //     // Función para eliminar una fila
    //     function eliminarFila() {
    //         var fila = $(this).closest('tr');
    //         table.row(fila).remove().draw();
    //     }

    //     // Vincular el botón "Eliminar" a la función eliminarFila
    //     $('#tabla tbody').on('click', '.btn-eliminar', eliminarFila);


    //     // Manejar evento de clic en el botón de agregar
    //     $('#button1').click(function () {
    //         var dropdownValue1 = $('#select1').val();
    //         var inputValue = $('#input1').val();
    //         var dropdownValue2 = $('#select2').val();
    //         var inputValue2 = $('#input3').val();
    //         if (dropdownValue1 != "" && inputValue != "" && dropdownValue2 != "" && inputValue2 != "") {
    //             $('#tabla').DataTable().row.add([dropdownValue1, inputValue, dropdownValue2, inputValue2, '<button type="button" class="btn btn-danger btn-sm btn-eliminar" >Eliminar</button>']).draw();
    //             // $('#select1').val("Seleccionar opción..."); // Reiniciar valor predeterminado del primer select
    //             $('#input1').val("1"); // Limpiar campo de texto
    //             // $('#select2').val("Seleccionar opción..."); // Reiniciar valor predeterminado del segundo select
    //             $('#input3').val("1"); // Limpiar campo de texto
    //         } else {
    //             alert("Debe seleccionar las opciones y proporcionar un valor.");
    //         }
    //     });
    // });




</script> -->